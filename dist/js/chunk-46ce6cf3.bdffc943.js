(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-46ce6cf3"],{1276:function(e,t,r){"use strict";var n=r("d784"),i=r("44e7"),a=r("825a"),s=r("1d80"),o=r("4840"),u=r("8aa5"),l=r("50c4"),m=r("14c3"),c=r("9263"),g=r("d039"),p=[].push,d=Math.min,f=4294967295,h=!g((function(){return!RegExp(f,"y")}));n("split",2,(function(e,t,r){var n;return n="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,r){var n=String(s(this)),a=void 0===r?f:r>>>0;if(0===a)return[];if(void 0===e)return[n];if(!i(e))return t.call(n,e,a);var o,u,l,m=[],g=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),d=0,h=new RegExp(e.source,g+"g");while(o=c.call(h,n)){if(u=h.lastIndex,u>d&&(m.push(n.slice(d,o.index)),o.length>1&&o.index<n.length&&p.apply(m,o.slice(1)),l=o[0].length,d=u,m.length>=a))break;h.lastIndex===o.index&&h.lastIndex++}return d===n.length?!l&&h.test("")||m.push(""):m.push(n.slice(d)),m.length>a?m.slice(0,a):m}:"0".split(void 0,0).length?function(e,r){return void 0===e&&0===r?[]:t.call(this,e,r)}:t,[function(t,r){var i=s(this),a=void 0==t?void 0:t[e];return void 0!==a?a.call(t,i,r):n.call(String(i),t,r)},function(e,i){var s=r(n,e,this,i,n!==t);if(s.done)return s.value;var c=a(e),g=String(this),p=o(c,RegExp),b=c.unicode,v=(c.ignoreCase?"i":"")+(c.multiline?"m":"")+(c.unicode?"u":"")+(h?"y":"g"),x=new p(h?c:"^(?:"+c.source+")",v),w=void 0===i?f:i>>>0;if(0===w)return[];if(0===g.length)return null===m(x,g)?[g]:[];var I=0,R=0,F=[];while(R<g.length){x.lastIndex=h?R:0;var y,U=m(x,h?g:g.slice(R));if(null===U||(y=d(l(x.lastIndex+(h?0:R)),g.length))===I)R=u(g,R,b);else{if(F.push(g.slice(I,R)),F.length===w)return F;for(var _=1;_<=U.length-1;_++)if(F.push(U[_]),F.length===w)return F;R=I=y}}return F.push(g.slice(I)),F}]}),!h)},"32fb":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{title:"物品损坏上报",visible:e.dialogVisible,"before-close":e.handleClose,width:"40%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("span",[r("b",[e._v(e._s(e.oldItemId_Name.itemName))])]),r("br"),r("br"),r("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"损坏数量",prop:"number"}},[r("el-input",{attrs:{type:"number",controls:!1,size:"mini",min:"1",max:e.oldItemId_Name.number},model:{value:e.ruleForm.number,callback:function(t){e.$set(e.ruleForm,"number",e._n(t))},expression:"ruleForm.number"}})],1),r("el-form-item",{attrs:{label:"损坏详情",prop:"inputText"}},[r("el-input",{attrs:{type:"textarea"},on:{blur:e.textProcessing},model:{value:e.ruleForm.inputText,callback:function(t){e.$set(e.ruleForm,"inputText",t)},expression:"ruleForm.inputText"}})],1),r("el-form-item",{attrs:{label:"上传图片",prop:"img"}},[r("el-upload",{ref:"imgLoad",attrs:{drag:"",action:"",multiple:"",accept:".png, .jpg, jpeg",limit:5,"list-type":"picture","on-change":e.change,"on-exceed":e.handleExceed,"auto-upload":!1}},[r("i",{staticClass:"el-icon-upload"}),r("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),r("em",[e._v("点击上传")])]),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传5张jpg/png文件")])])],1)],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary",loading:e.buttonLoading},on:{click:e.submit}},[e._v("确 定")])],1)],1)},i=[],a=(r("4160"),r("c975"),r("a15b"),r("b0c0"),r("a9e3"),r("d3b7"),r("4d63"),r("ac1f"),r("25f0"),r("5319"),r("1276"),r("159b"),r("96cf"),r("1da1")),s=r("c276"),o=r("365c"),u=r("5a0c"),l={name:"damageItemReport",props:{dialogArouse:{type:Number,required:!0},oldItemId_Name:{type:Object,required:!0}},data:function(){return{ruleForm:{number:1,inputText:"",imgUrls:"",img:[]},rules:{number:[{required:!0,message:"请输入损坏数量",trigger:"blur"},{required:!0,type:"number",min:1,max:this.oldItemId_Name.number,message:"请输入正确损坏数量",trigger:"blur"}],inputText:[{required:!0,message:"请输入损坏详情",trigger:"blur"}],img:[{required:!0,message:"上传损坏图片",trigger:"blur"}]},imgUrlData:["","","","",""],buttonLoading:!1,dialogVisible:!1}},watch:{dialogArouse:function(){"itemId"in this.oldItemId_Name?this.dialogVisible=!0:this.$message.error("当前未选中任何物品")}},methods:{dialogArouseOperate:function(){this.dialogVisible=!0},handleClose:function(e){var t=this;this.$confirm("确认关闭？").then((function(r){t.ruleForm={number:1,inputText:"",imgUrls:"",img:[]},t.$refs.ruleForm.clearValidate(),t.$refs.imgLoad.clearFiles(),e()})).catch((function(e){}))},handleExceed:function(e,t){this.$message.error("最多上传5张图片")},beforeUpload:function(e){var t=e.name.replace(/.+\./,""),r=e.size/1024/1024<=10,n=-1===["png","jpg","jpeg"].indexOf(t.toLowerCase());return n?(this.$message({type:"warning",message:"只能上传 .png, .jpg, .jpeg 文件！"}),this.$refs.img.clearFiles(),!1):!!r||(this.$message({type:"warning",message:"附件大小超限，文件不能超过 10M"}),this.$refs.img.clearFiles(),!1)},previewFile:function(e,t){var r=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var i,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:i=new Blob([e],{type:e.type}),s=null,e&&(s=new FileReader,s.readAsDataURL(i)),s.onload=Object(a["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=r.imageCompression(s.result),e.next=3,n.then((function(e){return t.push(e),Promise.resolve(e)}));case 3:r.ruleForm.imgBase64=t;case 4:case"end":return e.stop()}}),e)})));case 4:case"end":return n.stop()}}),n)})))()},pImg:function(e){return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){e.onload=function(){var r=parseInt(e.width)/parseInt(e.height);t(r)}})));case 1:case"end":return t.stop()}}),t)})))()},pCanvas:function(e,t,r,n){return Object(a["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.abrupt("return",new Promise((function(i,a){n.drawImage(e,0,0,t,1e3);var s=r.toDataURL();i(s)})));case 1:case"end":return i.stop()}}),i)})))()},imageCompression:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function r(){var n,i,a,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=new Image,i=document.createElement("canvas"),a=i.getContext("2d"),n.src=e,r.next=6,t.pImg(n);case 6:return s=r.sent,i.width=1e3*s,i.height=1e3,r.next=11,t.pCanvas(n,1e3*s,i,a);case 11:return r.abrupt("return",r.sent);case 12:case"end":return r.stop()}}),r)})))()},itemReportDamagedAPI:function(e){return Object(a["a"])(regeneratorRuntime.mark((function t(){var r,n,i,a,s,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.username,n=e.itemId,i=e.itemName,a=e.inputText,s=e.imgUrls,u=e.damageRecordTime,t.next=3,o["a"].ITEM_REPORT_DAMAGED_API({username:r,itemId:n,itemName:i,damageRecordDesc:a,damageRecordImg:s,damageRecordTime:u});case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))()},itemReportDamaged:function(e){var t=this,r=e.itemId,n=e.itemName,i=e.inputText,a=e.number,o=e.imgUrls,l=s["a"].cookies.get("username"),m=u().format("YYYY-MM-DD");i=i+"//////////"+a,this.itemReportDamagedAPI({username:l,itemId:r,itemName:n,inputText:i,imgUrls:o,damageRecordTime:m}).then((function(e){if(null===e)t.$message({message:"上传成功",type:"success"}),t.ruleForm={number:1,inputText:"",imgUrls:"",img:[]},t.$refs.ruleForm.clearValidate(),t.$refs.imgLoad.clearFiles(),t.dialogVisible=!1,t.buttonLoading=!1;else if("fail"===e)t.$message.error("上传失败"),t.buttonLoading=!1,t.imgUrlData=["","","","",""];else if(e.status>=4e4)return t.imgUrlData=["","","","",""],t.$log.push({message:"错误代码:"+e.status+","+e.message,type:"warning"}),t.$notify({title:e.message,message:"错误代码:"+e.status,position:"bottom-left",type:"warning"})}))},imgUploadAPI:function(e){return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o["a"].ITEM_DAMAGE_IMG_UPLOAD_API(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},imgUpload:function(e,t){var r=this,n=new FormData;n.append("file",new Blob([e.raw],{type:e.raw.type})),this.buttonLoading=!0,this.imgUploadAPI(n).then((function(e){if("http:"===e.split("/")[0]||"https:"===e.split("/")[0]){r.imgUrlData[t]=e;for(var n=[],i=0;i<r.ruleForm.img.length;i++){if(""===r.imgUrlData[i])return;n.push(r.imgUrlData[i])}r.ruleForm.imgUrls=n.join("//////////"),r.itemReportDamaged({itemId:r.oldItemId_Name.itemId,itemName:r.oldItemId_Name.itemName,inputText:r.ruleForm.inputText,imgUrls:r.ruleForm.imgUrls,number:r.ruleForm.number})}else if("fail"===e)r.$message.error("上传失败"),r.buttonLoading=!1,r.imgUrlData=["","","","",""];else if(e.status>=4e4)return r.imgUrlData=["","","","",""],r.$log.push({message:"错误代码:"+e.status+","+e.message,type:"warning"}),r.$notify({title:e.message,message:"错误代码:"+e.status,position:"bottom-left",type:"warning"})}))},textProcessing:function(){var e=new RegExp("/","g"),t=this.ruleForm.inputText.replace(e,"");this.ruleForm.inputText=t},change:function(e,t){this.beforeUpload(e,t)&&(this.ruleForm.img=t)},submit:function(){var e=this;this.$refs.ruleForm.validate((function(t){t?(e.ruleForm.imgUrls="",e.ruleForm.img.forEach((function(t,r){e.imgUpload(t,r)}))):e.$message.error("表单校验失败，请检查")}))}}},m=l,c=r("2877"),g=Object(c["a"])(m,n,i,!1,null,"5272e589",null);t["default"]=g.exports},"44e7":function(e,t,r){var n=r("861d"),i=r("c6b6"),a=r("b622"),s=a("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[s])?!!t:"RegExp"==i(e))}},"4d63":function(e,t,r){var n=r("83ab"),i=r("da84"),a=r("94ca"),s=r("7156"),o=r("9bf2").f,u=r("241c").f,l=r("44e7"),m=r("ad6d"),c=r("9f7f"),g=r("6eeb"),p=r("d039"),d=r("69f3").set,f=r("2626"),h=r("b622"),b=h("match"),v=i.RegExp,x=v.prototype,w=/a/g,I=/a/g,R=new v(w)!==w,F=c.UNSUPPORTED_Y,y=n&&a("RegExp",!R||F||p((function(){return I[b]=!1,v(w)!=w||v(I)==I||"/a/i"!=v(w,"i")})));if(y){var U=function(e,t){var r,n=this instanceof U,i=l(e),a=void 0===t;if(!n&&i&&e.constructor===U&&a)return e;R?i&&!a&&(e=e.source):e instanceof U&&(a&&(t=m.call(e)),e=e.source),F&&(r=!!t&&t.indexOf("y")>-1,r&&(t=t.replace(/y/g,"")));var o=s(R?new v(e,t):v(e,t),n?this:x,U);return F&&r&&d(o,{sticky:r}),o},_=function(e){e in U||o(U,e,{configurable:!0,get:function(){return v[e]},set:function(t){v[e]=t}})},D=u(v),$=0;while(D.length>$)_(D[$++]);x.constructor=U,U.prototype=x,g(i,"RegExp",U)}f("RegExp")}}]);